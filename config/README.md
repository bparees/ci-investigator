# Sippy Configuration

This is currently only used for Prow-based sippy, but could be expanded for general Sippy settings in the future.

Example:

```yaml
prow:
  url: https://prow.ci.openshift.org/prowjobs.js
releases:
  "Presubmits":
    regexp:
      - "^pull-ci-openshift-.*-(master|main)-e2e-.*"
  "4.12":
    jobs:
      aggregated-aws-sdn-upgrade-4.12-micro-release-openshift-release-analysis-aggregator: true
      aggregated-azure-ovn-upgrade-4.12-micro-release-openshift-release-analysis-aggregator: true
      aggregated-gcp-ovn-upgrade-4.12-minor-release-openshift-release-analysis-aggregator: true
```

## Prow

The Prow section of the configuration contains a URL, pointing to the prowjob.js endpoint which contains a JSON file of
all ProwJob's from the last 12 hours or so.

## Suites

Sippy expects every test it imports to belong to a test suite, this list
of suites will tell Sippy which ones to import. Others will be ignored.

## Releases

Releases is a map of releases, containing the release name, and possibly a list of regexp matchers or explicit list of
jobs that are part of the release.

# Generating the configuration

For OpenShift, the configuration is generated by sippy-config-generator
in [ci-tools](https://github.com/openshift/ci-tools/). You need an updated checkout of
the [OpenShift release repo](https://github.com/openshift/release/).

Example invocation:

```
./sippy-config-generator \
    --prow-jobs-dir ~/git/release/ci-operator/jobs \
    --release-config ~/git/release/core-services/release-controller/_releases \
    --customization-file ~/go/src/github.com/openshift/sippy/config/openshift-customizations.yaml
```

The customization file is an overlay that can be used to modify the generated configuration. For example, you can
exclude a job from being part of the Sippy configuration by setting the job to `false`, like this:

```yaml
  prow:
    url: https://prow.ci.openshift.org/prowjobs.js
  releases:
    "Presubmits":
      regexp:
        - "^pull-ci-openshift-.*-(master|main)-e2e-.*"
    "4.11":
      jobs:
        aggregated-aws-ovn-upgrade-4.11-micro-release-openshift-release-analysis-aggregator: false
```
